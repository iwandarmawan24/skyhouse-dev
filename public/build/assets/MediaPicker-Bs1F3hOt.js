import{j as e,$ as O,a0 as R,a1 as q,a2 as Q,d as n,S as $,a3 as b,I as A,z as G,U as J,a as T,O as K,Q as W,V as X}from"./vendor-BnbgrNvg.js";import{D as Y,a as Z,b as ee,c as ae,e as se}from"./Dialog-DwNRdUFJ.js";import{c,B as j}from"./Button-C9qRTbX8.js";import{I as te}from"./Input-BiTaUmO9.js";function re({className:r,...l}){return e.jsx(O,{"data-slot":"tabs",className:c("flex flex-col gap-2",r),...l})}function le({className:r,...l}){return e.jsx(R,{"data-slot":"tabs-list",className:c("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",r),...l})}function _({className:r,...l}){return e.jsx(q,{"data-slot":"tabs-trigger",className:c("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",r),...l})}function F({className:r,...l}){return e.jsx(Q,{"data-slot":"tabs-content",className:c("flex-1 outline-none",r),...l})}function ce({open:r,onClose:l,onSelect:D,multiple:d=!1,accept:x="image",folder:m=null}){const[U,v]=n.useState("library"),[y,N]=n.useState([]),[i,u]=n.useState(d?[]:null),[f,w]=n.useState(!1),[h,S]=n.useState(!1),[o,L]=n.useState(""),[k,z]=n.useState(1),[E,B]=n.useState(!1),g=async(a="",t=1)=>{w(!0);try{const s=await T.get("/admin/media-library/picker",{params:{type:x,search:a,folder:m,page:t}});s.data.success&&(N(t===1?s.data.media.data:C=>[...C,...s.data.media.data]),B(s.data.media.current_page<s.data.media.last_page),z(t))}catch(s){console.error("Failed to load media:",s)}finally{w(!1)}};n.useEffect(()=>{r&&g(o,1)},[r,o]);const I=async a=>{if(!a||a.length===0)return;S(!0);const t=new FormData;Array.from(a).forEach(s=>{t.append("files[]",s)}),m&&t.append("folder",m);try{const s=await T.post("/admin/media-library/upload",t,{headers:{"Content-Type":"multipart/form-data"}});s.data.success&&(await g(o,1),v("library"),!d&&s.data.media.length===1&&u(s.data.media[0]))}catch(s){console.error("Upload failed:",s),alert("Upload failed. Please try again.")}finally{S(!1)}},P=a=>{u(d?t=>{const s=Array.isArray(t)?t:[];return s.some(p=>p.uid===a.uid)?s.filter(p=>p.uid!==a.uid):[...s,a]}:t=>t?.uid===a.uid?null:a)},M=a=>d?Array.isArray(i)&&i.some(t=>t.uid===a.uid):i?.uid===a.uid,V=()=>{D(i),l(),u(d?[]:null)},H=a=>{switch(a){case"image":return A;case"video":return X;case"document":return W;default:return K}};return e.jsx(Y,{open:r,onOpenChange:l,children:e.jsxs(Z,{className:"max-w-5xl h-[80vh] flex flex-col p-0",children:[e.jsx(ee,{className:"px-6 py-4 border-b",children:e.jsx(ae,{children:"Select Media"})}),e.jsxs(re,{value:U,onValueChange:v,className:"flex-1 flex flex-col",children:[e.jsxs(le,{className:"px-6 border-b rounded-none bg-transparent",children:[e.jsx(_,{value:"library",children:"Media Library"}),e.jsx(_,{value:"upload",children:"Upload Files"})]}),e.jsxs(F,{value:"library",className:"flex-1 flex flex-col px-6 py-4 overflow-hidden",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx($,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(te,{placeholder:"Search media...",value:o,onChange:a=>L(a.target.value),className:"pl-10"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:f&&k===1?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(b,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):y.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center",children:[e.jsx(A,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-medium",children:"No media found"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Upload files to get started"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-4 gap-4",children:y.map(a=>{const t=H(a.file_type);return e.jsxs("div",{onClick:()=>P(a),className:c("relative aspect-square rounded-lg border-2 overflow-hidden cursor-pointer transition-all hover:shadow-md",M(a)?"border-primary ring-2 ring-primary ring-offset-2":"border-border hover:border-primary/50"),children:[a.file_type==="image"?e.jsx("img",{src:a.thumbnail_url,alt:a.alt_text||a.filename,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-muted",children:e.jsx(t,{className:"h-12 w-12 text-muted-foreground"})}),M(a)&&e.jsx("div",{className:"absolute inset-0 bg-primary/20 flex items-center justify-center",children:e.jsx("div",{className:"bg-primary text-primary-foreground rounded-full p-2",children:e.jsx(G,{className:"h-6 w-6"})})}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-2",children:[e.jsx("p",{className:"text-white text-xs truncate",children:a.filename}),e.jsx("p",{className:"text-white/70 text-xs",children:a.file_size_human})]})]},a.uid)})}),E&&e.jsx("div",{className:"mt-4 text-center",children:e.jsx(j,{variant:"outline",onClick:()=>g(o,k+1),disabled:f,children:f?e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"mr-2 h-4 w-4 animate-spin"}),"Loading..."]}):"Load More"})})]})})]}),e.jsx(F,{value:"upload",className:"flex-1 px-6 py-4",children:e.jsxs("div",{className:"border-2 border-dashed border-border rounded-lg p-12 text-center",children:[e.jsx("input",{type:"file",id:"media-upload",multiple:!0,accept:x==="image"?"image/*":x==="video"?"video/*":"*",onChange:a=>I(a.target.files),className:"hidden",disabled:h}),e.jsxs("label",{htmlFor:"media-upload",className:"cursor-pointer",children:[h?e.jsx(b,{className:"h-16 w-16 mx-auto text-muted-foreground animate-spin mb-4"}):e.jsx(J,{className:"h-16 w-16 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:h?"Uploading...":"Drop files to upload"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"or click to select files"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-4",children:"Maximum file size: 10MB"})]})]})})]}),e.jsx(se,{className:"px-6 py-4 border-t",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:d&&Array.isArray(i)&&i.length>0&&e.jsxs("span",{children:[i.length," item(s) selected"]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{variant:"outline",onClick:l,children:"Cancel"}),e.jsx(j,{onClick:V,disabled:d?Array.isArray(i)?i.length===0:!0:!i,children:"Insert Selected"})]})]})})]})})}export{ce as M};
